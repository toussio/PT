<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PT 트레이너 예약 시스템</title>
<style>
:root {
  --bg:#FFDEB3; --card:#FFF3E0; --accent:#f97316;
  --grad:linear-gradient(135deg,#ffb77a,#f97316,#ea580c);
  --ink:#2b1d12; --muted:#5c4033; --disabled:#bfa89c;
}
body{margin:0;font-family:"Pretendard",sans-serif;background:var(--bg);color:var(--ink);overflow-x:hidden;}
/* 인트로 */
.intro-overlay{position:fixed;inset:0;background:url('https://images.unsplash.com/photo-1558611848-73f7eb4001a1?auto=format&fit=crop&w=1400&q=80') center/cover no-repeat;
display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:999;text-align:center;color:#fff;backdrop-filter:blur(6px);}
.intro-bg{position:absolute;inset:0;background:rgba(0,0,0,0.4);}
.intro-content{position:relative;z-index:2;max-width:800px;background:rgba(255,243,224,0.9);padding:40px 30px;border-radius:20px;
box-shadow:0 0 20px rgba(249,115,22,0.4);color:var(--ink);}
.intro-content h1{font-size:2rem;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.intro-controls{display:flex;flex-direction:column;gap:10px;align-items:center;}
.intro-controls input{padding:10px 14px;border-radius:10px;border:2px solid #ffd6a5;width:70%;font-size:15px;}
.intro-controls button{background:var(--grad);color:#fff;border:none;padding:10px 24px;border-radius:12px;font-weight:600;cursor:pointer;
box-shadow:0 0 10px rgba(249,115,22,.4);transition:.3s;}
.intro-controls button:hover{transform:translateY(-3px);box-shadow:0 0 18px rgba(249,115,22,.6);}
.floating-btn{position:fixed;border:none;border-radius:50px;padding:12px 20px;font-weight:700;color:white;cursor:pointer;background:var(--grad);
box-shadow:0 4px 14px rgba(249,115,22,0.3);z-index:1500;transition:all .3s ease;}
.floating-btn:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(249,115,22,0.5);}
.floating-notice{top:20px;right:20px;}
.floating-admin{bottom:20px;right:20px;}
/* 공지 */
.notice-modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:3000;}
.notice-content{background:#fffaf3;border-radius:16px;padding:30px 40px;max-width:600px;width:90%;box-shadow:0 10px 25px rgba(0,0,0,0.3);}
.notice-content h2{background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-top:0;text-align:center;}
.notice-content ul{list-style:none;padding:0;margin:10px 0;}
.notice-content li{background:rgba(255,243,224,0.8);border-left:4px solid var(--accent);padding:12px 16px;border-radius:10px;margin:8px 0;}
.notice-close{float:right;font-weight:700;color:var(--accent);cursor:pointer;font-size:18px;}
/* 관리자 */
.admin-modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:2000;}
.admin-content{background:#fffaf3;padding:30px;border-radius:14px;max-width:950px;width:90%;box-shadow:0 0 20px rgba(0,0,0,.3);}
.admin-tabs{display:flex;gap:10px;margin-bottom:15px;}
.tab-btn{flex:1;padding:10px;border:none;border-radius:8px;font-weight:600;cursor:pointer;background:#ffd6a5;}
.tab-btn.active{background:var(--grad);color:#fff;}
.tab-content{display:none;}
.admin-content table{width:100%;border-collapse:collapse;margin-top:10px;}
.admin-content th,.admin-content td{border:1px solid #ffd6a5;padding:8px;text-align:center;}
.admin-close{float:right;cursor:pointer;color:#f97316;font-weight:bold;}
.trainer-time-box{margin-bottom:10px;}
.trainer-time-box label{margin-right:6px;}
/* 메인 */
.main{display:none;padding:40px 20px 80px;}
.trainer-section{display:flex;justify-content:center;align-items:center;gap:30px;margin-bottom:40px;}
.arrow{background:var(--grad);border:none;border-radius:50%;width:55px;height:55px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
.trainer-card{width:280px;border-radius:20px;background:var(--card);text-align:center;overflow:hidden;}
.trainer-card img{width:100%;height:180px;object-fit:cover;}
.trainer-card h3{margin:10px 0 4px;color:var(--accent);}
.schedule-section{max-width:800px;margin:0 auto;background:var(--card);border-radius:20px;padding:30px;}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;}
.day{text-align:center;padding:10px 0;border-radius:10px;background:rgba(255,255,255,0.7);cursor:pointer;}
.day.booked{background:var(--grad);color:#fff;}
.day.disabled{opacity:.4;cursor:not-allowed;}
.day.selected{outline:2px solid var(--accent);}
.time-select-area{margin-top:30px;display:flex;flex-direction:column;align-items:center;gap:18px;}
.time-select-area select{width:85%;background:#fffaf3;border:2px solid #ffd6a5;border-radius:20px;padding:16px 18px;}
button.reserve-btn{width:85%;background:var(--grad);color:#fff;border:none;border-radius:24px;padding:18px 22px;font-size:17px;font-weight:700;cursor:pointer;}
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);background:#fff8ee;color:var(--ink);border:2px solid #ffd6a5;border-radius:14px;padding:12px 24px;}
</style>
</head>
<body>

<!-- 인트로 -->
<div class="intro-overlay" id="intro">
  <div class="intro-bg"></div>
  <div class="intro-content">
    <h1>🏋️‍♀️ 작두 PT 센터</h1>
    <p>당신의 몸을 디자인하는 곳 — 최고의 트레이너들과 함께하세요.</p>
    <div class="intro-controls">
      <input id="userId" placeholder="고번 입력" />
      <input id="nickname" placeholder="닉네임 입력" />
      <button id="startBtn">시작하기</button>
    </div>
  </div>
</div>

<!-- 메인 -->
<div class="main" id="main">
  <h2 class="title">트레이너 예약 시스템</h2>
  <div class="trainer-section">
    <button class="arrow" id="prevBtn">◀</button>
    <div class="trainer-card" id="trainerCard"></div>
    <button class="arrow" id="nextBtn">▶</button>
  </div>

  <div class="schedule-section">
    <div class="calendar" id="calendar"></div>
    <div class="time-select-area">
      <select id="timeSelect"><option value="">시간 선택</option></select>
      <button class="reserve-btn" id="reserveBtn" disabled>예약하기</button>
    </div>
  </div>
</div>

<!-- floating -->
<button class="floating-btn floating-notice" id="noticeBtn">📢 공지사항</button>
<button class="floating-btn floating-admin" id="adminBtn">⚙ 관리자</button>

<!-- 공지사항 -->
<div class="notice-modal" id="noticeModal">
  <div class="notice-content">
    <span class="notice-close" id="noticeClose">✕</span>
    <h2>📢 작두 PT 센터 공지사항</h2>
    <ul id="noticeList"></ul>
  </div>
</div>

<!-- 관리자 -->
<div class="admin-modal" id="adminModal">
  <div class="admin-content">
    <span class="admin-close" id="adminClose">✕</span>
    <h2>⚙ 관리자 패널</h2>
    <div class="admin-tabs">
      <button class="tab-btn active" data-tab="reservations">📅 예약관리</button>
      <button class="tab-btn" data-tab="times">🕒 시간설정</button>
      <button class="tab-btn" data-tab="notices">📢 공지관리</button>
    </div>

    <div class="tab-content" id="tab-reservations" style="display:block;">
      <table><thead><tr><th>고번</th><th>닉네임</th><th>트레이너</th><th>날짜</th><th>시간</th><th>상태</th><th>관리</th></tr></thead><tbody id="adminTable"></tbody></table>
    </div>

    <div class="tab-content" id="tab-times">
      <h3>🕒 트레이너별 시간 설정</h3>
      <div id="trainerTimeList"></div>
      <button id="applyTimes">적용</button>
    </div>

    <div class="tab-content" id="tab-notices">
      <h3>📢 공지사항 추가</h3>
      <input id="newNotice" placeholder="공지 내용 입력" style="width:80%;padding:8px;">
      <button id="addNotice">추가</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, addDoc, updateDoc, deleteDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCmILB2NGpZmkSByWGjN1ZIBlxwQqRpHHg",
  authDomain: "pttt-dc58e.firebaseapp.com",
  projectId: "pttt-dc58e",
  storageBucket: "pttt-dc58e.appspot.com",
  messagingSenderId: "1015121703137",
  appId: "1:1015121703137:web:b4177af397cc5ed74887a0",
  measurementId: "G-2T9H6H06BT"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentUser=null;
const intro=document.getElementById("intro"),main=document.getElementById("main");
document.getElementById("startBtn").onclick=async()=>{
  const id=document.getElementById("userId").value.trim();
  const nick=document.getElementById("nickname").value.trim();
  if(!id||!nick)return showToast("고번과 닉네임을 입력하세요!");
  const ref=doc(db,"users",id);
  const snap=await getDoc(ref);
  if(!snap.exists()) await setDoc(ref,{nickname:nick,role:"member",createdAt:new Date()});
  currentUser={id,nick,...(snap.exists()?snap.data():{role:"member"})};
  intro.style.display="none";main.style.display="block";
};

const trainers=[{name:"트레이너 A"},{name:"트레이너 B"},{name:"트레이너 C"},{name:"트레이너 D"}];
let currentTrainer=0,selectedDate=null,bookings=[];
const trainerCard=document.getElementById("trainerCard"),calendar=document.getElementById("calendar"),
timeSelect=document.getElementById("timeSelect"),reserveBtn=document.getElementById("reserveBtn");

function showTrainer(i){trainerCard.innerHTML=`<img src='https://via.placeholder.com/260x180?text=${trainers[i].name}'><h3>${trainers[i].name}</h3>`;}
document.getElementById("prevBtn").onclick=()=>{currentTrainer=(currentTrainer-1+trainers.length)%trainers.length;showTrainer(currentTrainer);renderCalendar();};
document.getElementById("nextBtn").onclick=()=>{currentTrainer=(currentTrainer+1)%trainers.length;showTrainer(currentTrainer);renderCalendar();};

function renderCalendar(){
  calendar.innerHTML="";
  const now=new Date(),today=new Date(now.getFullYear(),now.getMonth(),now.getDate());
  const y=now.getFullYear(),m=now.getMonth();const fd=new Date(y,m,1),ld=new Date(y,m+1,0);
  for(let i=0;i<fd.getDay();i++)calendar.appendChild(document.createElement("div"));
  for(let d=1;d<=ld.getDate();d++){
    const date=new Date(y,m,d);const dateStr=`${y}-${m+1}-${d}`;
    const el=document.createElement("div");el.className="day";el.textContent=d;
    if(date<today)el.classList.add("disabled");
    el.onclick=()=>{if(el.classList.contains("disabled"))return;document.querySelectorAll(".day").forEach(x=>x.classList.remove("selected"));
      el.classList.add("selected");selectedDate=dateStr;updateTimeOptions();};
    calendar.appendChild(el);
  }
}

async function updateTimeOptions(){
  timeSelect.innerHTML='<option value="">시간 선택</option>';
  const trainer=trainers[currentTrainer].name;
  const timeDoc=await getDoc(doc(db,"settings","trainerTimes"));
  const available=timeDoc.exists()?timeDoc.data()[trainer]||[]:["10:00","12:00","14:00","16:00","18:00"];
  available.forEach(t=>{
    const opt=document.createElement("option");
    opt.value=t;opt.textContent=t;
    timeSelect.appendChild(opt);
  });
  reserveBtn.disabled=available.length===0;
}

function showToast(m){const t=document.createElement("div");t.className="toast";t.textContent=m;document.body.appendChild(t);setTimeout(()=>t.remove(),3000);}

reserveBtn.onclick=async()=>{
  if(!currentUser)return showToast("로그인이 필요합니다!");
  const trainer=trainers[currentTrainer].name;if(!selectedDate)return showToast("날짜 선택!");const time=timeSelect.value;if(!time)return showToast("시간 선택!");
  await addDoc(collection(db,"reservations"),{userId:currentUser.id,nickname:currentUser.nick,trainer,date:selectedDate,time,status:"reserved",createdAt:new Date()});
  showToast("예약 완료!");
};

/* 관리자 */
const adminBtn=document.getElementById("adminBtn"),adminModal=document.getElementById("adminModal"),adminClose=document.getElementById("adminClose");
const adminTabs=document.querySelectorAll(".tab-btn"),tabContents=document.querySelectorAll(".tab-content");
adminTabs.forEach(btn=>btn.onclick=()=>{adminTabs.forEach(b=>b.classList.remove("active"));btn.classList.add("active");
  tabContents.forEach(tc=>tc.style.display=tc.id==="tab-"+btn.dataset.tab?"block":"none");});

const ADMIN_CODE="admin1234";
adminBtn.onclick=async()=>{const c=prompt("관리자 코드를 입력하세요:");if(c!==ADMIN_CODE)return showToast("🚫 관리자 코드 오류");adminModal.style.display="flex";loadReservations();loadTimeSettings();loadNotices();};
adminClose.onclick=()=>adminModal.style.display="none";

async function loadReservations(){
  const q=await getDocs(collection(db,"reservations"));const t=document.getElementById("adminTable");t.innerHTML="";
  q.forEach(s=>{const d=s.data();const r=document.createElement("tr");
    r.innerHTML=`<td>${d.userId}</td><td>${d.nickname}</td><td>${d.trainer}</td><td>${d.date}</td><td>${d.time}</td><td>${d.status}</td>
    <td><button onclick="cancelReservation('${s.id}')">취소</button></td>`;t.appendChild(r);});
}
window.cancelReservation=async(id)=>{await updateDoc(doc(db,"reservations",id),{status:"cancelled"});showToast("예약 취소됨");loadReservations();};

/* 시간 설정 */
const trainerTimeList=document.getElementById("trainerTimeList"),allTimes=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17...00","18:00"];
async function loadTimeSettings(){
  const snap=await getDoc(doc(db,"settings","trainerTimes"));
  const data=snap.exists()?snap.data():{};
  trainerTimeList.innerHTML="";
  trainers.forEach(t=>{
    const div=document.createElement("div");
    div.className="trainer-time-box";
    div.innerHTML=`<h4>${t.name}</h4>`+
      allTimes.map(time=>{
        const checked=data[t.name]?.includes(time)?"checked":"";
        return `<label><input type="checkbox" value="${time}" ${checked}>${time}</label>`;
      }).join(" ");
    trainerTimeList.appendChild(div);
  });
}
document.getElementById("applyTimes").onclick=async()=>{
  const boxes=trainerTimeList.querySelectorAll(".trainer-time-box");
  const result={};
  boxes.forEach(b=>{
    const name=b.querySelector("h4").textContent;
    const selected=Array.from(b.querySelectorAll("input:checked")).map(i=>i.value);
    result[name]=selected;
  });
  await setDoc(doc(db,"settings","trainerTimes"),result);
  showToast("✅ 시간 설정 저장됨");
};

/* 공지사항 */
const noticeList=document.getElementById("noticeList");
async function loadNotices(){
  const q=await getDocs(collection(db,"notices"));noticeList.innerHTML="";
  q.forEach(s=>{
    const d=s.data();
    const li=document.createElement("li");
    li.textContent=d.message;
    li.onclick=async()=>{if(confirm("삭제하시겠습니까?")){await deleteDoc(doc(db,"notices",s.id));loadNotices();}};
    noticeList.appendChild(li);
  });
}
document.getElementById("addNotice").onclick=async()=>{
  const msg=document.getElementById("newNotice").value.trim();
  if(!msg)return showToast("내용 입력!");
  await addDoc(collection(db,"notices"),{message:msg,createdAt:new Date()});
  document.getElementById("newNotice").value="";
  loadNotices();
  showToast("📢 공지 추가됨");
};

/* 공지 모달 */
document.getElementById("noticeBtn").onclick=()=>{document.getElementById("noticeModal").style.display="flex";loadNotices();};
document.getElementById("noticeClose").onclick=()=>document.getElementById("noticeModal").style.display="none";

showTrainer(currentTrainer);
renderCalendar();
</script>
</body>
</html>
